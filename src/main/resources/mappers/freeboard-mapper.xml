<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="freeboardMapper">
  
  	<select id="getListCount" resultType="_int">
		select count(*)
		from FREEBOARD
		where frbstatus='Y'
	</select>
	
	<select id="selectList" resultType="FreeBoard">
		select *
		from FREEBOARD
		where frBSTATUS='Y'
		order by frBID desc
	</select>
	
	<insert id="insertBoard" parameterType="FreeBoard">
		insert into FREEBOARD
		values(FREEBOARD_SEQ.nextval, default , #{frbTitle}, #{frbContent}, #{frbWriter}, default,
				sysdate, sysdate, default)
	</insert>
	
	<select id="selectHbId" resultType="_int">
		select max(frbid)
		from FREEBOARD
	</select>
	
	<insert id="insertFile">
		insert into ATTACHMENT
		values (attachment_seq.nextval, #{bcode}, #{frbId}, #{originalFileName}, #{renameFileName} )
	</insert>
	
	<!-- <resultMap type="HMBoard" id="boardResultSet">
		<id property="hbId" column="HBID"/>
		<result property="bcode" column="BCODE"/>
		<result property="hbTitle" column="HBTITLE"/>
		<result property="hbWriter" column="HBWRITER"/>
		<result property="hbContent" column="HBCONTENT"/>
		<result property="hbCount" column="HBCOUNT"/>
		<result property="hbCreateDate" column="HBCREATEDATE"/>
		<result property="hbModifyDate" column="HBMODIFYDATE"/>
		<result property="hbStatus" column="HBSTATUS"/>
		
		<result property="hLocation" column="HLOCATION"/>
		<result property="hRentType" column="HRENTTYPE"/>
		<result property="hLivingType" column="HLIVINGTYPE"/>
		<result property="hRoom" column="HROOMCOUNT"/>
		<result property="hFloor" column="HFLOOR"/>
		<result property="hPrice" column="HPRICE"/>
		<result property="hParking" column="HPARKING"/>
		<result property="hReqgender" column="HREQGENDER"/>
	</resultMap> -->
	
	<!-- <update id="addReadCount" parameterType="_int">
		update HOUSEMATE_BOARD
		set HBCOUNT = HBCOUNT + 1
		where HBID = #{hbId}
	</update>
	
	<select id="selectBoard" parameterType="_int" resultType="HMBoard">
		select hb.*, a.ORIGINALFILENAME, a.renamefilename
		from HOUSEMATE_BOARD hb
		left join attachment a on a.bcode=hb.bcode
		where hb.hbid = a.refbid
		and hb.hbstatus='Y' 
		and hb.hbid =#{hbId} 
	</select>
	
	
	
	
	<update id="updateBoard" parameterType="HMBoard" >
		update HOUSEMATE_BOARD
		set hbtitle=#{hbTitle}, hbcontent=#{hbContent}, hlocation=#{hLocation}, 
			HBMODIFYDATE=sysdate, hrenttype=#{hRentType}, hlivingtype=#{hLivingType},
			hroomcount=#{hRoom}, hfloor=#{hFloor}, hprice=#{hPrice}, hparking=#{hParking}, hreqgender=#{hReqgender}
		where hbid=#{hbId}
	</update>
	
	<update id="updateFile" parameterType="HMBoard">
		update attachment
		set originalFilename = #{originalFileName},
			renameFileName = #{renameFileName}
		where bcode = #{bcode}
		and refbid = #{hbId}
	</update>
	
	<update id="deleteBoard" parameterType="_int">
		update HOUSEMATE_BOARD
		set HBSTATUS='N'
		where hbid = #{hbId}
	</update>
	
	<select id="selectReplyList" parameterType="_int" resultType="Reply">
		select * from Reply r
		join HOUSEMATE_BOARD hm on hm.bcode=r.bcode
		and r.refbid = hbid
		where refbid=${hbId}
	</select>
	
	<insert id="insertReply" parameterType="Reply">
		insert into Reply
		values (reply_seq.nextval, #{bCode}, #{rContent}, #{refbId}, #{rWriter}, SYSDATE, SYSDATE, default)	
	</insert>
	
	<select id="getSearchListCount" parameterType="hashmap" resultType="_int">
		select count(*)
		from HOUSEMATE_BOARD
		join member on(nickname = hbwriter)
		where HBstatus = 'Y'
		<if test="sCondition eq 'wr_subject'">
			and hbtitle like '%' || #{sValue} || '%'
		</if>
		<if test="sCondition eq 'wr_content'">
			and hbcontent like '%' || #{sValue} || '%'
		</if> 
		<if test="sCondition eq 'titleNcontent'">
			and (hbtitle like '%' || #{sValue} || '%' or hbcontent like '%' || #{sValue} || '%')
		</if> 
		<if test="sCondition eq 'email'">
			and email like '%' || #{sValue} || '%'
		</if> 
		<if test="sCondition eq 'hbwriter'">
			and hbwriter like '%' || #{sValue} || '%'
		</if> 
	</select>
	
	<select id="selectSearchList" parameterType="hashmap" resultType="HMBoard">
		select *
		from HOUSEMATE_BOARD
		join member on(nickname = hbwriter)
		where HBstatus = 'Y'
		<if test="sCondition eq 'wr_subject'">
			and hbtitle like '%' || #{sValue} || '%'
		</if>
		<if test="sCondition eq 'wr_content'">
			and hbcontent like '%' || #{sValue} || '%'
		</if> 
		<if test="sCondition eq 'titleNcontent'">
			and (hbtitle like '%' || #{sValue} || '%' or hbcontent like '%' || #{sValue} || '%')
		</if> 
		<if test="sCondition eq 'email'">
			and email like '%' || #{sValue} || '%'
		</if> 
		<if test="sCondition eq 'hbwriter'">
			and hbwriter like '%' || #{sValue} || '%'
		</if> 
		order by HBMODIFYDATE desc
	</select> -->
	
</mapper>
